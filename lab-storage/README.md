[![Review Assignment Due Date](https://classroom.github.com/assets/deadline-readme-button-22041afd0340ce965d47ae6ef1cefeee28c7c493a6346c4f15d667ab976d596c.svg)](https://classroom.github.com/a/ynZHbi27)
# CMPE281 Lab: Storage

In today's lab, we will explore the different storage classes available by AWS. We will start with creating an S3 bucket, and enabling versioning, encryption, and deletion protection. We will host a static site on S3, and we will discuss EFS and FSx Luster. To make this lab challenging, we will start to make the instructions more vague, requiring you to read more docs and get comfortable learning how things work on your own.

## Task 1: Create a New S3 Bucket and Upload a Folder (1 pt)

For this task, you need to uncomment the `aws_s3_bucket` and `aws_s3_object` in the `s3.tf` file and add the correct values. Use the documents below for reference. 

- [Terraform s3_bucket doc](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)
- [Terraform s3_object doc](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object)
- [Uploading multiple files guide](https://stackoverflow.com/questions/57456167/uploading-multiple-files-in-aws-s3-from-terraform)

Take a screenshot of your s3 bucket in the aws console with the uploaded files.


## Task 2: Generate and Use a Presigned URL (3 pts)

1. Use the complete URL of a private object in an S3 bucket belonging to you to generate a presigned URL using a variation of this command:
   ```
   aws s3 presign s3://<bucket-name>/index.html --expires-in 600
   ```

2. Copy the full URL from the command output and open it from a browser.
3. If the content type is not set to the correct file type for each file, your browser can interpret the `index.html` as an executible and try to download it instead of displaying it as a webpage. See [how to add content types per file in Terraform](https://stackoverflow.com/questions/76170291/how-do-i-specify-multiple-content-types-to-my-s3-object-using-terraform).
4. If your page now loads a plain html doc, you are on the right path. Question: Why doesn't the page load properly? 
5. Uncomment the `s3-bucketpolicy.tf` file and look up the docs in Terraform for each resource to find the correct values.
6. This time, the page should load like it does locally. Take a screen shot with the loaded website and the presigned URL in the browser to show you've completed this task.
7. Wait for the URL to expire and try accessing it again. This time, you should get an AccessDenied error.


## Task 3: Enable Static Website Hosting for an S3 Bucket (1 pt)

This is a good opportunity to present yourself to the world by creating a portfolio website. 

Reference: [S3 bucket website configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_website_configuration)

Make sure your static website is publicly accessible.

Take a screenshot of your URL and webpage.

## Task 4: Enable Versioning, Object Lock, and Lifecycle Management for your S3 Bucket (2 pts)

Create a new file named `task-4.tf`.

In this file, include the Terraform code for enabling versioning and object-lock.

Use the references:
- [S3 bucket versioning](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_versioning)
- [S3 bucket object lock config](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_object_lock_configuration)

Take two screenshots in the AWS console of versioning and object lock enabled.


## Extra Credit Opportunity

- (+1 pt) Learn about data types in Terraform and use the `data aws_caller_identity` resource to add your account id to your bucket name. Submit a screenshot of your  code using `data.aws_caller_identity.current.id` in your bucket name. Resource: [Terraform data caller_identity resource](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity)
- (+1 pt) Make it your own by filling out your own portfolio and using your own images. 
- (+1 pt) Use a different scheme from one of [these templates](https://html5up.net/).

# Deliverables

New instructions. All screenshots and knowledge check answers must be put in a PDF file. We will no longer use README.mds as they cannot be processed by Turnitin for plagiarism checking. 

## Knowledge Check (3 pts)

1. Explain how we use a single resource definition in task 1 to upload multiple files.
2. Explain why the bucket policy is required in task 2 to display the web-page properly.
3. What are the pros and cons of the resources you used in task 4?
4. Imagine you are managing an S3 bucket for a company that stores log files generated by their web applications. These log files are frequently accessed during the first 30 days after creation for analysis but are rarely accessed after that period. After 1 year, the logs don't need to be accessible immediately, but should be held for 5 years. Describe how you could use Amazon S3 Lifecycle Management to optimize storage costs for these log files. Include details on the lifecycle rules you would configure and how they would help reduce expenses.

## Lab Files

- `s3.tf`
- `s3-bucketpolicy.tf`
- `s3-staticwebsite.tf`
- `lab-storage.pdf` (contains)
  - Screenshot of S3 bucket and files in AWS Console (Task 1)
  - Screenshot of presigned URL and displayable page (Task 2)
  - Link to Static URL and displayable page (Task 3)
  - Screenshots of lifecycle management rules, object lock and versioning enabled (Task 4)
  - Knowledge check
    - Answer to question 1
    - Answer to question 2
    - Answer to question 3
    - Answer to question 4
